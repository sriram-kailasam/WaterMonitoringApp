extends layout

block head
	title #{waterBodyName} - Water Monitoring App

block content
	.container
		ul.nav.nav-tabs
			li.nav-item
				a.nav-link.active(data-toggle="tab" href="#table-tab") Table
			li.nav-item
				a.nav-link(data-toggle="tab" href="#graph-tab") Graph
		
		.tab-content
			.tab-pane.in.active#table-tab
				h1 #{waterBodyName}

				if temperatureData.length != 0
					table#temperatureDataTable.table.table-striped
						thead
							tr
								th Date
								th Time
								th Temperature

						tbody
							each temperatureInfo in temperatureData
								tr
									td #{temperatureInfo.date}
									td #{temperatureInfo.time}
									td #{temperatureInfo.temperature}
				else
					p Data not available

			.tab-pane.fade.in#graph-tab
				canvas#temperature-chart(width="undefined" height="undefined")

				script(src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js")
				script.
					let ctx = document.getElementById('temperature-chart').getContext('2d');

					let dataPoints = [];
					let timeLabels = [];
					fetch(`/api/waterbodies/#{waterBodyId}/temperature`)
						.then(function(response) {
							return response.json();
						})
						.then(function(json) {
							for (temperatureInfo of json.data.reverse()) {
								timeLabels.push(temperatureInfo.time);
								dataPoints.push(parseFloat(temperatureInfo.temperature));
							}

							let chart = new Chart(ctx, {
								type: 'line',
								data: {
									labels: timeLabels,
									datasets: [{
										label: "Temperature",
										fill: false,
										borderColor: '#7FFF00',
										backgroundColor: '#7FFF00',
										data: dataPoints
									}]
								},
								options: {
									title: {
										display: true,
										text: 'Variation of temperature with time'
									}
								}
							});
						});

block append scripts
	script(src='/socket.io/socket.io.js')
	script(src='/scripts/update_temperature_page.js')